---
layout: post
title: Lopez Controls
description: Initial Version
type: game
courses: { versions: {week: 0} }
---

<head>
    <meta name="layout" content="post">
    <meta name="title" content="Version 1.0">
    <meta name="description" content="Initial Version">
    <meta name="type" content="game">
    <meta name="courses" content="{ versions: {week: 0} }">
</head>

<html>
    <div class="gameWrapper">
        <div class="frameWrapper">
            <div id="topMenu">
                <button class="topMenuBtn" id="mainMenuBtn">Main Menu</button>
                <button class="topMenuBtn" id="inventoryBtn">Inventory</button>
                <button class="topMenuBtn" id="mapBtn">Map</button>
            </div>
            <canvas id="lopezContainer"> <!-- Within the base div is a canvas. An HTML canvas is used only for graphics. It allows the user to access some basic functions related to the image created on the canvas (including animation) -->
                <img id="LopezSprite" src="../../../images/lopezspritesheet2.png">  // change sprite here
            </canvas>
            <img id="backgroundImage" width="854" height="850" src="../../../images/mortensenlabbackground.jpg"/>
        </div>
    </div>
</html>

<script>
    // start on page load

    window.addEventListener('load', function () {
        const canvas = document.getElementById('lopezContainer');
        const ctx = canvas.getContext('2d');

        const SPRITE_WIDTH = 43.5;  // matches sprite pixel width
        const SPRITE_HEIGHT = 50.25; // matches sprite pixel height
        const SCALE_FACTOR = 2;  // control size of sprite on canvas

        let LOPEZ_SPEED = 4;
        let ANIMATION_SPEED = 100

        const FRAME_LIMIT = 4;  // matches number of frames per sprite row, this code assume each row is same

        const START_LEFT = 600;
        const START_TOP = 600;

        let isMoving = false;

        canvas.width = SPRITE_WIDTH * SCALE_FACTOR;
        canvas.height = SPRITE_HEIGHT * SCALE_FACTOR;


        class Lopez {
            constructor() {
                this.image = document.getElementById("LopezSprite");
                this.x = 0;
                this.y = 0;
                this.minFrame = 0;
                this.maxFrame = FRAME_LIMIT -1;
                this.frameX = 0;
                this.frameY = 0;
                this.left = START_LEFT;
                this.top = START_TOP;
                this.currentDirection = 'left'; 
            }

            draw(context) {
                context.drawImage(
                    this.image,
                    this.frameX * SPRITE_WIDTH,
                    this.frameY * SPRITE_HEIGHT,
                    SPRITE_WIDTH,
                    SPRITE_HEIGHT,
                    this.x,
                    this.y,
                    canvas.width,
                    canvas.height
                );

                canvas.style.left = lopez.left + "px"
                canvas.style.top = lopez.top + "px"
            }

            // update frameX of object
            updateFrame() {
                if (this.frameX < this.maxFrame) {
                    this.frameX++;
                } else {
                    this.frameX = 0;
                }
            }
        }

        const lopez = new Lopez();
    
        const validKeys = {
            "w": "up",
            "a": "left",
            "s": "down",
            "d": "right"

        }

        let currentKeys = []


        lopez.draw(ctx)
        
        document.addEventListener("keydown", (event) => {
            const key = event.key;

            if (!Object.keys(validKeys).includes(key)) return;

            if (!currentKeys.includes(key)) {
                currentKeys.push(validKeys[key]) //add to currentKeys
            } 

            if (currentKeys.length) {
                isMoving = true
            }

            
        })

        document.addEventListener("keyup", (event) => {
            const key = event.key;
            if (!Object.keys(validKeys).includes(key)) return;

            currentKeys = currentKeys.filter((currKey) => {
                    return currKey !== validKeys[key]  //remove from currentKeys 
            }) 

            if (!currentKeys.length) {
                isMoving = false
            }

            console.log(lopez)
        })

        function moveLopez () {
            if (currentKeys.includes("up") && isMoving) {
                lopez.top += -LOPEZ_SPEED
                canvas.style.top = lopez.top + "px"
            }
            if (currentKeys.includes("down") && isMoving) {
                lopez.top += LOPEZ_SPEED
                canvas.style.top = lopez.top + "px"
            }
            if (currentKeys.includes("left") && isMoving) {
                lopez.left += -LOPEZ_SPEED
                canvas.style.left = lopez.left + "px"
            }
            if (currentKeys.includes("right") && isMoving) {
                lopez.left += LOPEZ_SPEED
                canvas.style.left = lopez.left + "px"
            }

            if (currentKeys.length) lopez.currentDirection = currentKeys[0];

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draws the current frame of the sprite.
            lopez.draw(ctx);

            setTimeout(() => {requestAnimationFrame(moveLopez);}, LOPEZ_SPEED)
        }

        function animate() {
            switch (lopez.currentDirection) {
                case "up": 
                    lopez.frameY = 3;
                    break;
                case "left":
                    lopez.frameY = 1;
                    break;
                case "right":
                    lopez.frameY = 2;
                    break;
                case "down":
                    lopez.frameY = 0;
                    break;
                default: 
                    break;
            }

            if (isMoving) {
                lopez.updateFrame();
            }

            if (!isMoving) {
                lopez.frameX = 0;
            }

            setTimeout(() => {requestAnimationFrame(animate);}, ANIMATION_SPEED);
        }

        function controllerLoop () {
            moveLopez()
        }

        animate()
        controllerLoop()
    });
</script>

<style>
    .frameWrapper {
        margin: auto;
        width: 854px;
        border: 2px solid #00ADB5;
        text-align: center;
        margin-top: 1%;
    }
    
    .topMenuBtn {
        border: 0px;
        background-color: #393E46;
        padding: 15px;
    }

    .topMenuBtn:hover {
        border: 0px;
        background-color: #393e469f;
        padding: 15px;
    }

    #topMenu {
        display: flex;
        gap: 10px;
        background-color: #393e465c;
        justify-content: space-evenly;
        align-content: center;
        flex-direction: row;
        align-items: stretch;
    }

    #gameFrame {
        background-color: #fff;
        border-top: 2px solid #00ADB5;
    }

    #mortContainer {
        position: absolute;
        left: 500px;
        top: 500px;
    }

    #lopezContainer {
        position: absolute;
    }
</style>